<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>Cargar Archivos XML</title>
		<script src="/static/libs/jquery-2.1.1.min.js"></script>
		<link href="/static/css/bootstrap.min.css" rel="stylesheet" type="text/css">
		<link href="/static/css/bootstrap-responsive.min.css" rel="stylesheet" type="text/css">
		<link href="/static/css/jquery-ui-1.10.1.custom.min.css" type="text/css" rel="stylesheet">
		<link href="/static/css/bootstrap-modal.min.css" rel="stylesheet" type="text/css">
		<link href="/static/css/style.min.css" rel="stylesheet" type="text/css">
		<link href="/static/css/index-styles.min.css" rel="stylesheet" type="text/css">

		<link href="/static/css/fileinput.min.css" rel="stylesheet"/>
		<style>
			body {
				padding-top:50px;
				/*0089c3 por 004686*/
				/*background: linear-gradient(45deg, #7b44c4 -20%, #004686 50%);*/
				color: rgb(0, 70, 134);;
			}
			.row{
				padding-bottom: 15px;
			}
			.header-title{
				background-color: rgb(238, 238, 238);
				padding-left: 100px;
				padding-right: 10px;
/*				border-radius: 10px 10px 10px 10px;
                -moz-border-radius: 10px 10px 10px 10px;
                -webkit-border-radius: 10px 10px 10px 10px;*/
                color: black;
			}
			div[id='loading-div']{
				margin-top: 17%;
				margin-left: 45%;
				color:white;
			}
		</style>
	</head>
	<body>
		<div class="header-title">
			<div class="space-xs col-md-12"></div>
			<div class="row">
				<div class="span10 ">
						<h2>Cargar Archivos XML</h2>
				</div>
				<div class="span4">
					<!--- <a class="login" href="/cfmx/plantillas/rx/loginFD.cfm">Ingresar</a> --->
					<!--- <img  width="220" height="83" src="/static/images/img2.jpg"> --->
				</div>
			</div>
		</div>
		<header style="margin-bottom: 40px;">
			<div id="navbar">
				<div class="menu_bar">
					<a href="#" class="bt-menu"><img src="/cfmx/plantillas/rx/assets/img/hamburger-icon.svg" alt="menu"></a>
				</div>
				<nav>
					<ul>
						<li id="home" class="nav-active"><a href="/users/loadFiles">Cargar Archivos</a></li>
						<li id="contact"><a href="/users/dashboard">Ver Analisis de Archivos</a></li>
						<li id="home"><a href="/auth/logout">Salir</a></li>
					</ul>
				</nav>
			</div>
		</header>

		<div id="createNewUser" style="margin-left:3%" class="main-wrapper">
			<div  class="span12">
				<form name="sendNewFile" id="sendNewFile"  enctype="multipart/form-data" >
					<p style="text-align:justify;">Busque y seleccione el archivo local </p>
					<div class="row-fluid">
						<div class="control-group">
							<labe for="name">

							</labe>
							<div class="controls">
								<input id="newFile" name="newFile" class="file" type="file" accept=".xml, .xmls" data-initial-Caption="Archivo XML">
							</div>
						</div>
						<div class="row-fluid">
							<div class="col-md-2 " style="">
								<button type="button" class="btn btn-success" style="float: right; margin:10px" onclick="loadFile()">Cargar Archivo</button>
							</div>
						</div>
					</div>
					<div class="row-fluid">
						<div class="control-group ">
							<labe for="name">
								Listado de Archivos cargados
							</labe>
							<div class="controls">
								<table id="listBills" data-toggle="table" class="display table table-bordered" data-url="/users/getMyBills">
								    <thead>
								        <tr>

								        	<th data-field="consecutive">Numero Factura</th>
								            <th data-field="idissuing">Id emisor</th>
								            <th data-field="nameissuing">Nombre emisor</th>
								            <th data-field="idreceiver">Id receptor</th>
								            <th data-field="namereceiver">Nombre receptor</th>
								            <th data-field="codemoney">Moneda</th>
								            <th data-field="totalsales">Total Venta</th>
								        </tr>
								    </thead>
								</table>
							</div>
						</div>
					</div>
				</form>
			</div>
		</div>
		<div class="" ="isloading-overlay"></div>
		<div id="error_dialog" title="Error" class="error_dialog">
			<p id="error_message"></p>
		</div>

		<div id="warning_dialog" title="Advertencia" class="warning_dialog">
			<p id="warning_message"></p>
		</div>

		<div id="confirm_dialog" title="Advertencia" class="confirm_dialog">
			<p id="confirm_message"></p>
		</div>

		<div id="correct_dialog" title="Informaci&oacute;n" class="correct_dialog">
			<p id="correct_message"></p>
		</div>
	</body>
	<script src="/static/libs/jquery-ui-1.10.1.custom.min.js" type="text/javascript"></script>
	<script src="/static/libs/bootstrap.min.js" type="text/javascript"></script>
	<script src="/static/libs/query.blockui.min.js" type="text/javascript"></script>
	<script src="/static/libs/jquery.isloading.js" type="text/javascript"></script>
	<script src="/static/libs/library.js"	type="text/javascript"></script>
	<script src="/static/libs/footer.js"	type="text/javascript"></script>
	<script src="/static/libs/jquery.validate.min.js" type="text/javascript"></script>
	<script src="/static/libs/bootstrap-fileupload.min.js" type="text/javascript"></script>
	<script src="/static/libs/jquery.form.min.js" type="text/javascript"></script>
	<script src="/static/libs/bootstrap-table.min.js"></script>
	<script src="/static/libs/bootstrap-table-es-CR.min.js"></script>
</html>

<script type="text/javascript">

	$(document).ready(function(){

	  $.ajax({
	       url: '/users/getMyBills',
	       dataType: 'json',
	       success: function(data) {
	           $('#listBills').bootstrapTable({
	           		consecutive:data.consecutive,
	              	idissuing	: data.idissuing,
	              	nameissuing : data.nameissuing,
	              	idreceiver : data.idreceiver,
	              	namereceiver : data.namereceiver,
	              	codemoney	: data.codemoney,
	              	totalsales :data.totalsales
	           });
	       },
	       error: function(e) {
	           console.log(e.responseText);
	       }
	    });
	 });

	function loadFile() {
		if($('#sendNewFile').valid()){
			var fileUpload = document.getElementById("newFile");
			var formData = new FormData();
			formData.append('newFile', $("#newFile")[0].files[0]);
			$.ajax({
				type: "POST",
				url: "/users/loadFile",
				data: formData,
				contentType: false,
				processData: false,
				beforeSend: function(){ //se muestra una imagen mientras el ajax se ejecuta
					showIsLoading("Procesando...");
				}
			}).done(function (data) {
				fnOpenSusessDialog("Se ha guardado con exito");
				$("#newFile").val("");
				//recordame que debo actualizar la tabla
				$('#listBills').bootstrapTable('refresh', {silent: true});
			}).fail(function (data) {
				hideIsLoading();
				fnOpenErrorDialog(data.responseJSON.message);
			}).always(function (data) {
				hideIsLoading();
			});

		}
		else{
			//fnOpenErrorDialog("Todos los campos son requeridos");
		}
	}

	$('#sendNewFile').validate({
		errorElement: 'label', //default input error message container
		errorClass: 'help-inline', // default input error message class
		ignore: "",
		rules: {
			newFile: { required: true}
		},
		messages: { // custom messages
			newFile: { required: "Debe buscar y seleccionar el XML." }
		},
		highlight: function (element) { // hightlight error inputs
			$(element).closest('.control-group').addClass('error'); // set error class to the control group
		},
		success: function (label) {
			label.closest('.control-group').removeClass('error');
			label.remove();
		},
		errorPlacement: function (error, element) {
			if (element.closest('.icon-search').size() === 1) {
				error.addClass('help-small no-left-padding').insertAfter(element.closest('.icon-search'));
			} else if (element.next().attr("class")){
				error.addClass('help-small no-left-padding').insertAfter(element.next());
			} else {
				error.addClass('help-small no-left-padding').insertAfter(element);
			}
		}
	});

</script>